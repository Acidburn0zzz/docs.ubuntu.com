<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>The Metadata API &mdash; MAAS dev documentation</title>
    
    <link rel="stylesheet" href="../_static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://assets.ubuntu.com/sites/guidelines/css/latest/ubuntu-styles.css" type="text/css" />
    <link rel="stylesheet" href="https://assets.ubuntu.com/sites/ubuntu/latest/u/css/global.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/main.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     'dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/maas.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="top" title="MAAS dev documentation" href="../index.html" />
    <link rel="next" title="RPC HOWTO" href="rpc.html" />
    <link rel="prev" title="How preseeds work in MAAS" href="preseeds.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="rpc.html" title="RPC HOWTO"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="preseeds.html" title="How preseeds work in MAAS"
             accesskey="P">previous</a> |</li>
  <li class="nav-item nav-item-0">
    <a href="http://maas.io/docs/">Latest documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
  </li>
  <li class="nav-item nav-item-0">
    <a href="../index.html">MAAS dev documentation</a>
  </li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="the-metadata-api">
<h1>The Metadata API<a class="headerlink" href="metadata.html#the-metadata-api" title="Permalink to this headline">¶</a></h1>
<p>A MAAS region controller provides a separate API (the metadata API) for the
benefit of the nodes themselves.  This is where a node obtains the details of
how it should be set up, such as which SSH keys should be installed in order to
give a particular user remote access to the system.</p>
<p>As a MAAS user or administrator, you do not need to request this information
yourself.  It is normally up to <code class="docutils literal"><span class="pre">cloud-init</span></code> to do this while setting up the
node.  You&#8217;ll find more about how this works in cloud-init&#8217;s <a class="reference external" href="http://cloudinit.readthedocs.org/en/latest/topics/datasources.html">datasources</a>
documentation.</p>
<div class="section" id="similarity-to-ec2">
<h2>Similarity to EC2<a class="headerlink" href="metadata.html#similarity-to-ec2" title="Permalink to this headline">¶</a></h2>
<p>The metadata API is very similar, and partly identical, to the EC2 metadata
service.  It follows a similar directory structure and provides several items
in the same formats.  For example, in order to find out its own host name, a
node would perform an http GET request for:</p>
<div class="highlight-python"><div class="highlight"><pre>/2012-03-01/meta-data/local-hostname
</pre></div>
</div>
<p>The first item in the path is the API version.  The API has been extended since
March 2012, but not changed incompatibly and so that date is still the current
version number.</p>
<p>The items following that form a directory hierarchy based on that of the EC2
metadata service.  The metadata service &#8220;knows&#8221; which node makes the request,
and so there is no need for the request URL to identify the node whose hostname
should be retrieved.  The request automatically returns the hostname for the
node which requested it.</p>
<p>Just like EC2, the MAAS metadata API will accept GET requests to:</p>
<div class="highlight-python"><div class="highlight"><pre>/
/2012-03-01/
/2012-03-01/meta-data/
/2012-03-01/meta-data/instance-id
/2012-03-01/meta-data/local-hostname
/2012-03-01/meta-data/public-keys
/2012-03-01/user-data
</pre></div>
</div>
<p>Hopefully their meanings are fairly obvious.  The <code class="docutils literal"><span class="pre">public-keys</span></code> will contain
the user&#8217;s SSH keys.</p>
<p>MAAS adds a tarball of scripts that a node should run during its commissioning
phase:</p>
<div class="highlight-python"><div class="highlight"><pre>/2012-03-01/meta-data/maas-commissioning-scripts
</pre></div>
</div>
<p>There are other differences.  Where EC2 makes the metadata service available at
a fixed IP address, MAAS configures the location of the metadata service on the
node while installing its operating system.  It does this through installation
<a class="reference internal" href="preseeds.html#preseeds"><span>preseeds</span></a>.  These preseeds also include the node&#8217;s access
credentials.</p>
</div>
<div class="section" id="additional-directory-trees">
<h2>Additional Directory Trees<a class="headerlink" href="metadata.html#additional-directory-trees" title="Permalink to this headline">¶</a></h2>
<p id="enlistment-tree">MAAS adds some entirely new directories as well.  An enlisting node
(which does not have access credentials for the metadata API yet) can
anonymously request the same items for itself under <code class="docutils literal"><span class="pre">/enlist/</span></code>, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre>/enlist/2012-03-01/meta-data/local-hostname
</pre></div>
</div>
<p>If you set the <code class="docutils literal"><span class="pre">ALLOW_UNSAFE_METADATA_ACCESS</span></code> configuration item, the
metadata service will also provide the information on arbitrary nodes to
authenticated users under a separate sub-tree.  For security reasons this is
not recommended, but it may be useful in debugging.  With this option enabled,
the information for the node with MAC address 99:99:99:99:99:99 is available
at:</p>
<div class="highlight-python"><div class="highlight"><pre>/2012-03-01/by-mac/99:99:99:99:99:99/meta-data/local-hostname
</pre></div>
</div>
<p>And so on for the other information.  There is a similar facility keyed by
MAAS system identifiers.</p>
<p id="curtin-tree">Finally, a curtin-specific metadata API with largely the same information lives
in the <code class="docutils literal"><span class="pre">/curtin/</span></code> subtree:</p>
<div class="highlight-python"><div class="highlight"><pre>/curtin/2012-03-01/meta-data/local-hostname
</pre></div>
</div>
<p>The curtin subtree however differs in the <code class="docutils literal"><span class="pre">user-data</span></code> endpoint.  It returns a
curtin-specific form of user data.</p>
</div>
<div class="section" id="authentication">
<h2>Authentication<a class="headerlink" href="metadata.html#authentication" title="Permalink to this headline">¶</a></h2>
<p>Most metadata requests are authenticated similar to ones to the
region-controller API, through OAuth.  Every node in a MAAS has its own OAuth
key.  (On the region controller side, these keys collectively belong to a
single special user called <code class="docutils literal"><span class="pre">node-init</span></code>.  You will not see such special users
listed in the UI, however.)  When a node asks for information about itself, the
OAuth key is what tells the metadata service which node that is.</p>
<p>Not all requests are authenticated in this way.  For instance, a node can
access the items under the enlistment subdirectory (see
<a class="reference internal" href="metadata.html#enlistment-tree"><span>above</span></a>) anonymously.  The metadata service will
identify the requesting node by its IP address.</p>
</div>
<div class="section" id="api-operations">
<h2>API Operations<a class="headerlink" href="metadata.html#api-operations" title="Permalink to this headline">¶</a></h2>
<p>The MAAS metadata API supports a few non-GET operations.  These work just like
the ones on the main <a class="reference internal" href="../api.html#region-controller-api"><span>region-controller API</span></a>, but they are meant to be invoked by
nodes.  The URL for these calls is <code class="docutils literal"><span class="pre">/2013-03-01/</span></code>, and the operation name is
passed as a multipart form item called &#8220;op&#8221;.  Other parameters are passed in
the same way.</p>
<p>The <code class="docutils literal"><span class="pre">signal</span></code> call notifies the region controller of the state of a
commissioning node.  The node sends running updates, as well as output produced
by the commissioning scripts, and finally completion information through this
call.</p>
<p>When a node is done installing, it may call POST operations <code class="docutils literal"><span class="pre">netboot_on</span></code> and
<code class="docutils literal"><span class="pre">netboot_off</span></code> to instruct MAAS to enable or disable its network boot setting.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<a style="border:0" title="MAAS Documentation Homepage" href="../index.html"><img src="../_static/maas-logo-200.png" alt="MAAS logo"/></a>
<h2 style="text-align:center;">MAAS</h2>
<p style="font-style:italic;font-size:0.9em; text-align:center; margin-bottom:1.5em">Metal As A Service.</p>
<span id="version_switcher"></span>
<br/>
<br/>

  <ul>
<li><a class="reference internal" href="metadata.html#">The Metadata API</a><ul>
<li><a class="reference internal" href="metadata.html#similarity-to-ec2">Similarity to EC2</a></li>
<li><a class="reference internal" href="metadata.html#additional-directory-trees">Additional Directory Trees</a></li>
<li><a class="reference internal" href="metadata.html#authentication">Authentication</a></li>
<li><a class="reference internal" href="metadata.html#api-operations">API Operations</a></li>
</ul>
</li>
</ul>
<script type="text/javascript">
$(document).ready(function () {
  if (true) {
    $.ajaxSetup({cache: true});
    $.getScript('/docs/_static/versions.js', function() {
      console.log( "Versions script loaded." );
      set_up_version_switcher('#version_switcher', 'docs');
    });
}
});
</script>

<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="preseeds.html" title="previous chapter">How preseeds work in MAAS</a></li>
      <li>Next: <a href="rpc.html" title="next chapter">RPC HOWTO</a></li>
  </ul></li>
</ul>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/development/metadata.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="rpc.html" title="RPC HOWTO"
             >next</a></li>
        <li class="right" >
          <a href="preseeds.html" title="How preseeds work in MAAS"
             >previous</a> |</li>
  <li class="nav-item nav-item-0">
    <a href="http://maas.io/docs/">Latest documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
  </li>
  <li class="nav-item nav-item-0">
    <a href="../index.html">MAAS dev documentation</a>
  </li>
 
      </ul>
    </div>
<footer class="global clearfix">
  <div class="legal clearfix">
    <p>&copy; Copyright 2012-2015, MAAS Developers. Ubuntu and Canonical are registered trademarks of
      <a href="http://canonical.com">Canonical Ltd</a>.
    </p>
    <p>
      Revision 4595
 (2016-08-24 14:59:26 +0000).
      Documentation generation date: 2016-08-24 16:22:23 +0100.
    </p>
  </div>
</footer>
  </body>
</html>