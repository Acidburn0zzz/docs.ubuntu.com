<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>How cluster registration works in MAAS &mdash; MAAS dev documentation</title>
    
    <link rel="stylesheet" href="/static/maas-1.9/flasky.css" type="text/css" />
    <link rel="stylesheet" href="/static/maas-1.9/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://assets.ubuntu.com/sites/guidelines/css/latest/ubuntu-styles.css" type="text/css" />
    <link rel="stylesheet" href="https://assets.ubuntu.com/sites/ubuntu/latest/u/css/global.css" type="text/css" />
    <link rel="stylesheet" href="/static/maas-1.9/css/main.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     'dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="/static/maas-1.9/jquery.js"></script>
    <script type="text/javascript" src="/static/maas-1.9/underscore.js"></script>
    <script type="text/javascript" src="/static/maas-1.9/doctools.js"></script>
    <link rel="shortcut icon" href="/static/maas-1.9/maas.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="top" title="MAAS dev documentation" href="../index.html" />
    <link rel="next" title="Bootstrapping a cluster" href="cluster-bootstrap.html" />
    <link rel="prev" title="Building Ubuntu packages of MAAS" href="building-packages.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="cluster-bootstrap.html" title="Bootstrapping a cluster"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="building-packages.html" title="Building Ubuntu packages of MAAS"
             accesskey="P">previous</a> |</li>
  <li class="nav-item nav-item-0">
    <a href="http://maas.io/docs/">Latest documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
  </li>
  <li class="nav-item nav-item-0">
    <a href="../index.html">MAAS dev documentation</a>
  </li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="how-cluster-registration-works-in-maas">
<h1>How cluster registration works in MAAS<a class="headerlink" href="cluster-registration.html#how-cluster-registration-works-in-maas" title="Permalink to this headline">¶</a></h1>
<p>A region controller associates with one or more cluster controllers, each
of which is responsible for contacting the region controller itself and
announcing its presence.  An admin must accept or reject each cluster that
registers itself with the region controller, except in the special
circumstance mentioned in <a class="reference internal" href="cluster-registration.html#first-cluster"><span>First cluster to connect</span></a>.</p>
<p>There is always at least one cluster controller in MAAS (known as a
NodeGroup in the code) which is known as the &#8216;master&#8217;. The Nodegroup entry
always exists even if no cluster controllers have contacted the region
controller yet, so that it can be used as a default when adding nodes in the
API or UI before the cluster controller is defined.  Once a real cluster
controller connects it will become this master.</p>
<p>This logic was originally implemented as an easy way to upgrade older
installations that were created before nodegroups were introduced.</p>
<div class="section" id="region-controller-location">
<h2>Region Controller Location<a class="headerlink" href="cluster-registration.html#region-controller-location" title="Permalink to this headline">¶</a></h2>
<p>The cluster obviously needs to know where the region controller is, and
this is configured in a file <code class="docutils literal"><span class="pre">/etc/maas/clusterd.conf</span></code>. This should
only ever be modified via the <code class="docutils literal"><span class="pre">maas-provision</span></code> command.</p>
</div>
<div class="section" id="first-cluster-to-connect">
<span id="first-cluster"></span><h2>First cluster to connect<a class="headerlink" href="cluster-registration.html#first-cluster-to-connect" title="Permalink to this headline">¶</a></h2>
<p>For the convenience of small setups (and the development environment), the
first cluster controller to connect to the region controller becomes the
&#8216;master&#8217; nodegroup, and if the cluster connects <em>from the same host</em>, it
is automatically accepted.</p>
<p>The logic currently looks like this:</p>
<ol class="arabic simple">
<li>If there is one, the oldest nodegroup is the master.</li>
<li>If none exists, the code creates a placeholder master nodegroup on the fly,
pre-accepted but without a UUID.</li>
<li>If the placeholder is the only nodegroup, the first cluster controller to
register becomes the master.</li>
</ol>
<p>Sadly, there is some code complexity to clear up here as this logic is not
encapsulated in a single place, but instead in both:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">NodeGroup.objects.ensure_data()</span></code> and</li>
<li><code class="docutils literal"><span class="pre">AnonNodeGroupsHandler.register()</span></code>.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<a style="border:0" title="MAAS Documentation Homepage" href="../index.html"><img src="/static/maas-1.9/maas-logo-200.png" alt="MAAS logo"/></a>
<h2 style="text-align:center;">MAAS</h2>
<p style="font-style:italic;font-size:0.9em; text-align:center; margin-bottom:1.5em">Metal As A Service.</p>
<span id="version_switcher"></span>
<br/>
<br/>

  <ul>
<li><a class="reference internal" href="cluster-registration.html#">How cluster registration works in MAAS</a><ul>
<li><a class="reference internal" href="cluster-registration.html#region-controller-location">Region Controller Location</a></li>
<li><a class="reference internal" href="cluster-registration.html#first-cluster-to-connect">First cluster to connect</a></li>
</ul>
</li>
</ul>
<script type="text/javascript">
$(document).ready(function () {
  if (true) {
    $.ajaxSetup({cache: true});
    $.getScript('/static/maas-1.9/versions.js', function() {
      console.log( "Versions script loaded." );
      set_up_version_switcher('#version_switcher', 'docs');
    });
}
});
</script>

<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="building-packages.html" title="previous chapter">Building Ubuntu packages of MAAS</a></li>
      <li>Next: <a href="cluster-bootstrap.html" title="next chapter">Bootstrapping a cluster</a></li>
  </ul></li>
</ul>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="/static/maas-1.9/development/cluster-registration.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="cluster-bootstrap.html" title="Bootstrapping a cluster"
             >next</a></li>
        <li class="right" >
          <a href="building-packages.html" title="Building Ubuntu packages of MAAS"
             >previous</a> |</li>
  <li class="nav-item nav-item-0">
    <a href="http://maas.io/docs/">Latest documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
  </li>
  <li class="nav-item nav-item-0">
    <a href="../index.html">MAAS dev documentation</a>
  </li>
 
      </ul>
    </div>
<footer class="global clearfix">
  <div class="legal clearfix">
    <p>&copy; Copyright 2012-2015, MAAS Developers. Ubuntu and Canonical are registered trademarks of
      <a href="http://canonical.com">Canonical Ltd</a>.
    </p>
    <p>
      Revision 4595
 (2016-08-24 14:59:26 +0000).
      Documentation generation date: 2016-08-24 16:22:23 +0100.
    </p>
  </div>
</footer>
  </body>
</html>