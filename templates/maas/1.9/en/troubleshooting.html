<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MAAS Troubleshooting &mdash; MAAS dev documentation</title>
    
    <link rel="stylesheet" href="/static/maas-1.9/flasky.css" type="text/css" />
    <link rel="stylesheet" href="/static/maas-1.9/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://assets.ubuntu.com/sites/guidelines/css/latest/ubuntu-styles.css" type="text/css" />
    <link rel="stylesheet" href="https://assets.ubuntu.com/sites/ubuntu/latest/u/css/global.css" type="text/css" />
    <link rel="stylesheet" href="/static/maas-1.9/css/main.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     'dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="/static/maas-1.9/jquery.js"></script>
    <script type="text/javascript" src="/static/maas-1.9/underscore.js"></script>
    <script type="text/javascript" src="/static/maas-1.9/doctools.js"></script>
    <link rel="shortcut icon" href="/static/maas-1.9/maas.ico"/>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="top" title="MAAS dev documentation" href="index.html" />
    <link rel="next" title="maas-region-admin" href="man/maas-region-admin.8.html" />
    <link rel="prev" title="Getting help" href="getting-help.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="man/maas-region-admin.8.html" title="maas-region-admin"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="getting-help.html" title="Getting help"
             accesskey="P">previous</a> |</li>
  <li class="nav-item nav-item-0">
    <a href="http://maas.io/docs/">Latest documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
  </li>
  <li class="nav-item nav-item-0">
    <a href="index.html">MAAS dev documentation</a>
  </li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="maas-troubleshooting">
<h1>MAAS Troubleshooting<a class="headerlink" href="troubleshooting.html#maas-troubleshooting" title="Permalink to this headline">¶</a></h1>
<p>Some parts of MAAS may still be a little confusing, and sometimes you might be
trying to do things that are just plain impossible. This section covers some of
the most commonly encountered problems and tries its best to make them gone.</p>
<div class="contents local topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="troubleshooting.html#nodes-hang-on-commissioning" id="id1">Nodes hang on &#8220;Commissioning&#8221;</a></li>
<li><a class="reference internal" href="troubleshooting.html#nodes-fail-to-pxe-boot" id="id2">Nodes fail to PXE boot</a></li>
<li><a class="reference internal" href="troubleshooting.html#can-t-log-in-to-node" id="id3">Can&#8217;t log in to node</a></li>
<li><a class="reference internal" href="troubleshooting.html#forgot-maas-superuser-password" id="id4">Forgot MAAS superuser password</a></li>
<li><a class="reference internal" href="troubleshooting.html#need-to-reconfigure-server-ip-address" id="id5">Need to reconfigure server IP address</a></li>
<li><a class="reference internal" href="troubleshooting.html#can-t-find-maas-webpage" id="id6">Can&#8217;t find MAAS webpage</a></li>
<li><a class="reference internal" href="troubleshooting.html#debugging-ephemeral-image" id="id7">Debugging ephemeral image</a></li>
</ul>
</div>
<div class="section" id="nodes-hang-on-commissioning">
<h2><a class="toc-backref" href="troubleshooting.html#id1">Nodes hang on &#8220;Commissioning&#8221;</a><a class="headerlink" href="troubleshooting.html#nodes-hang-on-commissioning" title="Permalink to this headline">¶</a></h2>
<div class="section" id="possible-cause-timing-issues">
<h3>Possible Cause: Timing issues<a class="headerlink" href="troubleshooting.html#possible-cause-timing-issues" title="Permalink to this headline">¶</a></h3>
<p>Various parts of MAAS rely on OAuth to negotiate a connection to nodes. If the
current time reported by the hardware clock on your node differs significantly
from that on the MAAS server, the connection will not be made.</p>
<p><strong>SOLUTION:</strong> Check that the hardware clocks are consistent, and if necessary,
adjust them. This can usually be done from within the system BIOS, without
needing to install an OS</p>
</div>
<div class="section" id="possible-cause-network-drivers">
<h3>Possible Cause: Network drivers<a class="headerlink" href="troubleshooting.html#possible-cause-network-drivers" title="Permalink to this headline">¶</a></h3>
<p>Sometimes the hardware can boot from PXE, but fail to load correct drivers when
booting the received image. This is sometimes the case when no open source
drivers are available for the network hardware.</p>
<p><strong>SOLUTION:</strong> The best fix for this problem is to install a Linux-friendly
network adapter. It <em>is</em> theoretically possible to modify the boot image to
include proprietary drivers, but it is not a straightforward task.</p>
</div>
</div>
<div class="section" id="nodes-fail-to-pxe-boot">
<h2><a class="toc-backref" href="troubleshooting.html#id2">Nodes fail to PXE boot</a><a class="headerlink" href="troubleshooting.html#nodes-fail-to-pxe-boot" title="Permalink to this headline">¶</a></h2>
<div class="section" id="possible-cause-using-an-incorrectly-configured-vm">
<h3>Possible Cause: Using an incorrectly configured VM<a class="headerlink" href="troubleshooting.html#possible-cause-using-an-incorrectly-configured-vm" title="Permalink to this headline">¶</a></h3>
<p>Some Virtual Machine setups include emulation of network hardware that does not
support PXE booting, and in most setups, you will need to explicitly set up the
VM to boot via PXE.</p>
<p><strong>SOLUTION</strong>: Consult the VM docs for details of PXE booting.</p>
</div>
<div class="section" id="possible-cause-dhcp-conflict">
<h3>Possible Cause: DHCP conflict<a class="headerlink" href="troubleshooting.html#possible-cause-dhcp-conflict" title="Permalink to this headline">¶</a></h3>
<p>If you are using MAAS in a setup with an existing DHCP, <em>DO NOT SET UP THE MAAS
DHCP SERVER</em> as this will cause no end of confusion to the rest of your network
and most likely won&#8217;t discover any nodes either.</p>
<p><strong>SOLUTION</strong>: You will need to configure your existing DHCP server to
point to the MAAS server.</p>
</div>
</div>
<div class="section" id="can-t-log-in-to-node">
<h2><a class="toc-backref" href="troubleshooting.html#id3">Can&#8217;t log in to node</a><a class="headerlink" href="troubleshooting.html#can-t-log-in-to-node" title="Permalink to this headline">¶</a></h2>
<p>Sometimes you may wish to login directly to a node on your system. If
you have set up Juju and MAAS, the attached nodes will automatically
receive existing ssh keys and sets up ssh on the node to authenticate
via key, so you can just login with no password from the server.
There is also an option in the MAAS web interface to add new ssh keys
to the nodes (via Preferences in the drop down menu which appears when
clicking your username in the top-right of the page).</p>
</div>
<div class="section" id="forgot-maas-superuser-password">
<h2><a class="toc-backref" href="troubleshooting.html#id4">Forgot MAAS superuser password</a><a class="headerlink" href="troubleshooting.html#forgot-maas-superuser-password" title="Permalink to this headline">¶</a></h2>
<p>As long as you have sudo privileges, this is not a disaster. You can
use the <code class="docutils literal"><span class="pre">maas</span></code> command to change the password for the MAAS superuser
on the MAAS server:</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">maas</span> <span class="pre">changepassword</span> <span class="pre">root</span></code></div></blockquote>
</div>
<div class="section" id="need-to-reconfigure-server-ip-address">
<h2><a class="toc-backref" href="troubleshooting.html#id5">Need to reconfigure server IP address</a><a class="headerlink" href="troubleshooting.html#need-to-reconfigure-server-ip-address" title="Permalink to this headline">¶</a></h2>
<p>If you made a mistake during setup or you just need to reconfigure your MAAS
server, you can simply run the setup again:</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">dpkg-reconfigure</span> <span class="pre">maas-region-controller</span></code></div></blockquote>
</div>
<div class="section" id="can-t-find-maas-webpage">
<h2><a class="toc-backref" href="troubleshooting.html#id6">Can&#8217;t find MAAS webpage</a><a class="headerlink" href="troubleshooting.html#can-t-find-maas-webpage" title="Permalink to this headline">¶</a></h2>
<p>The default webpage is located at <code class="docutils literal"><span class="pre">http://&lt;hostname&gt;/MAAS/</span></code>. If you can&#8217;t
access it, there are a few things to try:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Check that the webserver is running - By default the web interface uses
Apache, which runs under the service name <em>apache2</em>. To check it, on the
MAAS server box you can run <code class="docutils literal"><span class="pre">sudo</span> <span class="pre">/etc/init.d/apache2</span> <span class="pre">status</span></code>.</li>
<li>Check that the hostname is correct - It may seem obvious, but check that
the hostname is being resolved properly. Try running a browser (even a text
mode one like lynx) on the same box as the MAAS server and navigating to
the page. If that doesn&#8217;t work, try <code class="docutils literal"><span class="pre">http://127.0.0.1/MAAS/</span></code>, which will
always point at the local server.</li>
<li>If you are still getting &#8220;404 - Page not found&#8221; errors, check that the MAAS
web interface has been installed in the right place. There should be a file
present called /usr/share/maas/maas/urls.py</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="debugging-ephemeral-image">
<h2><a class="toc-backref" href="troubleshooting.html#id7">Debugging ephemeral image</a><a class="headerlink" href="troubleshooting.html#debugging-ephemeral-image" title="Permalink to this headline">¶</a></h2>
<div class="section" id="backdoor-add-a-login-to-ephemeral-images">
<h3>Backdoor (add a login) to ephemeral images<a class="headerlink" href="troubleshooting.html#backdoor-add-a-login-to-ephemeral-images" title="Permalink to this headline">¶</a></h3>
<p>If you cannot login to an instance, you might have to &#8220;backdoor it&#8221; in order
to see what is going wrong. Scott Moser wrote a simple utility that injects a
user and password into an image. Here&#8217;s how to add a &#8216;backdoor&#8217; user with a
password to your images:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo apt-get install --assume-yes bzr
bzr branch lp:~maas-maintainers/maas/backdoor-image backdoor-image

imgs=$(echo /var/lib/maas/boot-resources/*/*/*/*/*/*/root-image)
for img in $imgs; do
    [ -f &quot;$img.dist&quot; ] || sudo cp -a --sparse=always $img $img.dist
done

for img in $imgs; do
    sudo ./backdoor-image/backdoor-image -v --user=backdoor --password-auth --password=ubuntu $img
done
</pre></div>
</div>
</div>
<div class="section" id="inside-the-ephemeral-image">
<h3>Inside the ephemeral image<a class="headerlink" href="troubleshooting.html#inside-the-ephemeral-image" title="Permalink to this headline">¶</a></h3>
<p>Important files for debugging (Someone is likely to ask you for these
things to help debug):</p>
<div class="highlight-python"><div class="highlight"><pre>/var/log/cloud-init.log
/var/log/boot.log
/var/log/cloud-init-output.log
</pre></div>
</div>
<p>After enlistment or commissioning, the user-data from maas instructs the system
to power off. To stop that from happening, you can just create a file in /tmp:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">touch</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">block</span><span class="o">-</span><span class="n">poweroff</span>
</pre></div>
</div>
</div>
<div class="section" id="maas-credentials">
<h3>MAAS credentials<a class="headerlink" href="troubleshooting.html#maas-credentials" title="Permalink to this headline">¶</a></h3>
<p>MAAS credentials can be found in 2 places:</p>
<ol class="arabic">
<li><p class="first">from the cmdline you&#8217;ll see a <code class="docutils literal"><span class="pre">url=</span></code> or <code class="docutils literal"><span class="pre">cloud-config-url=</span></code>
parameter. You can get the cloud-config from that url, which will have
credentials:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sed -n &#39;s,.*url=\([^ ]*\).*,\1,p&#39; /proc/cmdline
http://10.55.60.194/MAAS/metadata/latest/enlist-preseed/?op=get_enlist_preseed
</pre></div>
</div>
</li>
<li><p class="first">from <code class="docutils literal"><span class="pre">/etc/cloud/cloud.cfg.d/91_kernel_cmdline_url</span></code>. The file was pulled
from <code class="docutils literal"><span class="pre">url=</span></code> parameter by cloud-init:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo cat /etc/cloud/cloud.cfg.d/91_kernel_cmdline
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="maas-datasource">
<h3>MAAS datasource<a class="headerlink" href="troubleshooting.html#maas-datasource" title="Permalink to this headline">¶</a></h3>
<p>The cloud-init datasource for MAAS can be invoked as a &#8216;main&#8217; for debugging
purposes. To do so, you need to know the url for the MAAS datasource and a
config file that contains credentials:</p>
<div class="highlight-python"><div class="highlight"><pre>cfg=$(echo /etc/cloud/cloud.cfg.d/*_cmdline_url.cfg)
echo $cfg /etc/cloud/cloud.cfg.d/91_kernel_cmdline_url.cfg
</pre></div>
</div>
<p>Now get the metadata_url from there:</p>
<div class="highlight-python"><div class="highlight"><pre>url=$(sudo awk &#39;$1 == &quot;metadata_url:&quot; { print $2 }&#39; $cfg)
echo $url http://10.55.60.194/MAAS/metadata/enlist
</pre></div>
</div>
<p>Invoke the client /usr/share/pyshared/cloudinit/sources/DataSourceMAAS.py
The client has &#8211;help Usage also, but here is an example of how to use it:</p>
<div class="highlight-python"><div class="highlight"><pre>$ maasds=&quot;/usr/share/pyshared/cloudinit/sources/DataSourceMAAS.py&quot;
$ sudo python $maasds --config=$cfg get $url
== http://10.55.60.194/MAAS/metadata/enlist ==
2012-03-01
latest
$ sudo python $maasds --config=$cfg get $url/latest/meta-data/local-hostname
maas-enlisting-node
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<a style="border:0" title="MAAS Documentation Homepage" href="index.html"><img src="/static/maas-1.9/maas-logo-200.png" alt="MAAS logo"/></a>
<h2 style="text-align:center;">MAAS</h2>
<p style="font-style:italic;font-size:0.9em; text-align:center; margin-bottom:1.5em">Metal As A Service.</p>
<span id="version_switcher"></span>
<br/>
<br/>

  <ul>
<li><a class="reference internal" href="troubleshooting.html#">MAAS Troubleshooting</a><ul>
<li><a class="reference internal" href="troubleshooting.html#nodes-hang-on-commissioning">Nodes hang on &#8220;Commissioning&#8221;</a><ul>
<li><a class="reference internal" href="troubleshooting.html#possible-cause-timing-issues">Possible Cause: Timing issues</a></li>
<li><a class="reference internal" href="troubleshooting.html#possible-cause-network-drivers">Possible Cause: Network drivers</a></li>
</ul>
</li>
<li><a class="reference internal" href="troubleshooting.html#nodes-fail-to-pxe-boot">Nodes fail to PXE boot</a><ul>
<li><a class="reference internal" href="troubleshooting.html#possible-cause-using-an-incorrectly-configured-vm">Possible Cause: Using an incorrectly configured VM</a></li>
<li><a class="reference internal" href="troubleshooting.html#possible-cause-dhcp-conflict">Possible Cause: DHCP conflict</a></li>
</ul>
</li>
<li><a class="reference internal" href="troubleshooting.html#can-t-log-in-to-node">Can&#8217;t log in to node</a></li>
<li><a class="reference internal" href="troubleshooting.html#forgot-maas-superuser-password">Forgot MAAS superuser password</a></li>
<li><a class="reference internal" href="troubleshooting.html#need-to-reconfigure-server-ip-address">Need to reconfigure server IP address</a></li>
<li><a class="reference internal" href="troubleshooting.html#can-t-find-maas-webpage">Can&#8217;t find MAAS webpage</a></li>
<li><a class="reference internal" href="troubleshooting.html#debugging-ephemeral-image">Debugging ephemeral image</a><ul>
<li><a class="reference internal" href="troubleshooting.html#backdoor-add-a-login-to-ephemeral-images">Backdoor (add a login) to ephemeral images</a></li>
<li><a class="reference internal" href="troubleshooting.html#inside-the-ephemeral-image">Inside the ephemeral image</a></li>
<li><a class="reference internal" href="troubleshooting.html#maas-credentials">MAAS credentials</a></li>
<li><a class="reference internal" href="troubleshooting.html#maas-datasource">MAAS datasource</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<script type="text/javascript">
$(document).ready(function () {
  if (true) {
    $.ajaxSetup({cache: true});
    $.getScript('/static/maas-1.9/versions.js', function() {
      console.log( "Versions script loaded." );
      set_up_version_switcher('#version_switcher', 'docs');
    });
}
});
</script>

<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="getting-help.html" title="previous chapter">Getting help</a></li>
      <li>Next: <a href="man/maas-region-admin.8.html" title="next chapter">maas-region-admin</a></li>
  </ul></li>
</ul>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="/static/maas-1.9/troubleshooting.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="man/maas-region-admin.8.html" title="maas-region-admin"
             >next</a></li>
        <li class="right" >
          <a href="getting-help.html" title="Getting help"
             >previous</a> |</li>
  <li class="nav-item nav-item-0">
    <a href="http://maas.io/docs/">Latest documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
  </li>
  <li class="nav-item nav-item-0">
    <a href="index.html">MAAS dev documentation</a>
  </li>
 
      </ul>
    </div>
<footer class="global clearfix">
  <div class="legal clearfix">
    <p>&copy; Copyright 2012-2015, MAAS Developers. Ubuntu and Canonical are registered trademarks of
      <a href="http://canonical.com">Canonical Ltd</a>.
    </p>
    <p>
      Revision 4595
 (2016-08-24 14:59:26 +0000).
      Documentation generation date: 2016-08-24 16:22:23 +0100.
    </p>
  </div>
</footer>
  </body>
</html>