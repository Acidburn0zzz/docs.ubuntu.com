<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Making use of Tags &mdash; MAAS 1.9 documentation</title>
    
    <link rel="stylesheet" href="/static/maas-1.9/flasky.css" type="text/css" />
    <link rel="stylesheet" href="/static/maas-1.9/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://assets.ubuntu.com/sites/guidelines/css/latest/ubuntu-styles.css" type="text/css" />
    <link rel="stylesheet" href="https://assets.ubuntu.com/sites/ubuntu/latest/u/css/global.css" type="text/css" />
    <link rel="stylesheet" href="/static/maas-1.9/css/main.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     'dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="/static/maas-1.9/jquery.js"></script>
    <script type="text/javascript" src="/static/maas-1.9/underscore.js"></script>
    <script type="text/javascript" src="/static/maas-1.9/doctools.js"></script>
    <link rel="shortcut icon" href="/static/maas-1.9/maas.ico"/>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="top" title="MAAS 1.9 documentation" href="index.html" />
    <link rel="next" title="Physical Zones" href="physical-zones.html" />
    <link rel="prev" title="Juju Quick Start" href="juju-quick-start.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="physical-zones.html" title="Physical Zones"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="juju-quick-start.html" title="Juju Quick Start"
             accesskey="P">previous</a> |</li>
  <li class="nav-item nav-item-0">
    <a href="/maas/">Latest documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
  </li>
  <li class="nav-item nav-item-0">
    <a href="index.html">MAAS 1.9 documentation</a>
  </li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="making-use-of-tags">
<span id="deploy-tags"></span><h1>Making use of Tags<a class="headerlink" href="tags.html#making-use-of-tags" title="Permalink to this headline">¶</a></h1>
<p>MAAS implements a system of tags based on the physical properties of
the nodes.  The idea behind this is that you can use the tags to
identify nodes with particular abilities which may be useful when it
comes to deploying services.</p>
<p>A real world example of this might be to identify nodes which have
fast GPUs installed, if you were planning on deploying software which
used CUDA or OpenCL which would make use of this hardware.</p>
<div class="section" id="tag-definitions">
<h2>Tag definitions<a class="headerlink" href="tags.html#tag-definitions" title="Permalink to this headline">¶</a></h2>
<p>Before we can create a tag we need to know how we will select which nodes it
gets applied to. MAAS collects hardware information from the nodes using the
<a class="reference external" href="http://ezix.org/project/wiki/HardwareLiSter">&#8220;lshw&#8221; utility</a> to return
detailed information in XML format. The definitions used in creating a tag are
then constructed using XPath expressions.
If you are unfamiliar with XPath expressions, it is well worth checking out the
<a class="reference external" href="http://www.w3schools.com/xpath/xpath_syntax.asp">w3schools documentation</a>.
For the lshw XML, we will just check all the available nodes for some
properties.
In our example case, we might want to find GPUs with a clock speed of over
1GHz.
In this case, the relevant XML node from the output will be labelled &#8220;display&#8221;
and does have a property called clock, so it will look like this:</p>
<div class="highlight-python"><div class="highlight"><pre>//node[@id=&quot;display&quot;]/clock &gt; 1000000000
</pre></div>
</div>
<p>Now we have a definition, we can go ahead and create a tag.</p>
</div>
<div class="section" id="creating-a-tag">
<h2>Creating a tag<a class="headerlink" href="tags.html#creating-a-tag" title="Permalink to this headline">¶</a></h2>
<p>Once we have sorted out what definition we will be using, creating the
tag is easy using the <code class="docutils literal"><span class="pre">maas</span></code> command. You will need to <a class="reference internal" href="maascli.html#api-key"><span>be
logged in to the API first</span></a>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ maas maas tags new name=&#39;gpu&#39; \
  comment=&#39;GPU with clock speed &gt;1GHz for running CUDA type operations.&#39; \
  definition=&#39;//node[@id=&quot;display&quot;]/clock &gt; 1000000000&#39;
</pre></div>
</div>
<p>The comment is really for your benefit. It pays to keep the actual tag name
short and to the point as you will be using it frequently in commands, but it
may subsequently be hard to work out what exactly was the difference between
tags like &#8220;gpu&#8221; and &#8220;fastgpu&#8221; unless you have a good comment. Something which
explains the definition in plain language is always a good idea!</p>
<p>To check which nodes this tag applies to we can use the tag command:</p>
<div class="highlight-python"><div class="highlight"><pre>$ maas maas tag nodes gpu
</pre></div>
</div>
<p>The process of updating the tags does take some time  - not a lot of time, but
if nothing shows up straight away, try running the command again after a minute
or so.</p>
</div>
<div class="section" id="using-the-tag">
<h2>Using the tag<a class="headerlink" href="tags.html#using-the-tag" title="Permalink to this headline">¶</a></h2>
<p>You can use the tag in the web interface to discover applicable nodes, but the
real significance of it is when using juju to deploy services. Tags can be used
with juju constraints to make sure that a particular service only gets deployed
on hardware with the tag you have created.</p>
<p>Example:
To use the &#8216;gpu&#8217; tag we created to run a service called &#8216;cuda&#8217; we would use:</p>
<div class="highlight-python"><div class="highlight"><pre>$ juju deploy --constraints tags=gpu cuda
</pre></div>
</div>
<p>You could list several tags if required, and mix in other juju constraints if
needed:</p>
<div class="highlight-python"><div class="highlight"><pre>$ juju deploy --constraints &quot;mem=1024 tags=gpu,intel&quot; cuda
</pre></div>
</div>
</div>
<div class="section" id="manually-assigning-tags">
<h2>Manually assigning tags<a class="headerlink" href="tags.html#manually-assigning-tags" title="Permalink to this headline">¶</a></h2>
<p>MAAS supports the creation of arbitrary tags which don&#8217;t depend on XPath
definitions (&#8220;nodes which make a lot of noise&#8221; perhaps). If a tag is created
without specifying the definition parameter then it will simply be ignored by
tag refresh mechanism, but the MAAS administrator will be able to manually add
and remove the tag from specific nodes.</p>
<p>In this example we are assuming you are using the &#8216;maas&#8217; profile and you want
to create a tag called &#8216;my_tag&#8217;:</p>
<div class="highlight-python"><div class="highlight"><pre>$ maas maas tags new name=&#39;my_tag&#39; comment=&#39;nodes which go ping&#39;
$ maas maas tag update-nodes my_tag add=&quot;&lt;system_id&gt;&quot;
</pre></div>
</div>
<p>The first line creates a new tag but omits the definition, so no nodes are
automatically added to it. The second line applies that tag to a specific node
referenced by its system id property.</p>
<p>You can easily remove a tag from a particular node, or indeed add
and remove them at the same time:</p>
<div class="highlight-python"><div class="highlight"><pre>$ maas maas tag update-nodes my_tag add=&lt;system_id_1&gt; \
  add=&lt;system_id_2&gt; add=&lt;system_id_3&gt; remove=&lt;system_id_4&gt;
</pre></div>
</div>
<p>As the rule is that tags without a definition are ignored when rebuilds are
done, it is also possible to create a normal tag with a definition, and then
subsequently edit it to remove the definition. From this point the tag behaves
as if you had manually created it, but it still retains all the existing
associations it has with nodes. This is particularly useful if you have some
hardware which is conceptually similar but doesn&#8217;t easily fit within a single
tag definition:</p>
<div class="highlight-python"><div class="highlight"><pre>$ maas maas tag new name=&#39;my_tag&#39; comment=&#39;nodes I like &#39; \
   definition=&#39;contains(//node[@id=network]/vendor, &quot;Intel&quot;)&#39;
$ maas maas tag update my_tag definition=&#39;&#39;
$ maas mass tag update-nodes my_tag add=&lt;system_id&gt;
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">If you add and remove the same node in one operation, it ends up having
the tag removed (even if the tag was in place before the operation).</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<a style="border:0" title="MAAS Documentation Homepage" href="index.html"><img src="/static/maas-1.9/maas-logo-200.png" alt="MAAS logo"/></a>
<h2 style="text-align:center;">MAAS</h2>
<p style="font-style:italic;font-size:0.9em; text-align:center; margin-bottom:1.5em">Metal As A Service.</p>
<span id="version_switcher"></span>
<br/>
<br/>

  <ul>
<li><a class="reference internal" href="tags.html#">Making use of Tags</a><ul>
<li><a class="reference internal" href="tags.html#tag-definitions">Tag definitions</a></li>
<li><a class="reference internal" href="tags.html#creating-a-tag">Creating a tag</a></li>
<li><a class="reference internal" href="tags.html#using-the-tag">Using the tag</a></li>
<li><a class="reference internal" href="tags.html#manually-assigning-tags">Manually assigning tags</a></li>
</ul>
</li>
</ul>
<script type="text/javascript">
$(document).ready(function () {
  if (true) {
    $.ajaxSetup({cache: true});
    $.getScript('/static/maas-1.9/versions.js', function() {
      console.log( "Versions script loaded." );
      set_up_version_switcher('#version_switcher', 'docs');
    });
}
});
</script>

<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="juju-quick-start.html" title="previous chapter">Juju Quick Start</a></li>
      <li>Next: <a href="physical-zones.html" title="next chapter">Physical Zones</a></li>
  </ul></li>
</ul>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="/static/maas-1.9/tags.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="physical-zones.html" title="Physical Zones"
             >next</a></li>
        <li class="right" >
          <a href="juju-quick-start.html" title="Juju Quick Start"
             >previous</a> |</li>
  <li class="nav-item nav-item-0">
    <a href="/maas/">Latest documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
  </li>
  <li class="nav-item nav-item-0">
    <a href="index.html">MAAS 1.9 documentation</a>
  </li>
 
      </ul>
    </div>
<footer class="global clearfix">
  <div class="legal clearfix">
    <p>&copy; Copyright 2012-2015, MAAS Developers. Ubuntu and Canonical are registered trademarks of
      <a href="http://canonical.com">Canonical Ltd</a>.
    </p>
    <p>
      Revision 4595
 (2016-08-24 14:59:26 +0000).
      Documentation generation date: 2016-08-24 16:22:23 +0100.
    </p>
  </div>
</footer>
  </body>
</html>